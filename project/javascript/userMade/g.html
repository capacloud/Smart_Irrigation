<html>
<head>
	<title>Irrigation network</title>

	<script type="text/javascript">
		mxBasePath = '../src';
	</script>

	<script type="text/javascript" src="../src/js/mxClient.js"></script>

	<script type="text/javascript">

		function main(container, pressureChange, wi, hi, mainV, mainVloss,walls )
		{
			if (!mxClient.isBrowserSupported())
			{
				mxUtils.error('Browser is not supported!', 200, false);
			}
			else
			{
				mxEvent.disableContextMenu(container);

				var graph = new mxGraph(container);

				new mxRubberband(graph);
				var parent = graph.getDefaultParent();

				graph.getModel().beginUpdate();
				try
				{
          			var g=10, rho=1000;
					var v1 = graph.insertVertex(parent, null, '', 20, 20, 20, 20, 'fillColor=blue');

					var width= wi*2;
					var height= hi*2;
					//width= width*2;
					//height= height*2;

					var prevSub= v1;
					var tempSub;
					var prevEmit;
					var tempEmit;
					var xEmit;
					var xSub= 20;
					var yEmit;
					var ySub= 20+54;
          			var yloss =0;
          			var tempPY=0;
          			var kineticH=0;
					//console.log(width+","+height);

                    var n28 = Math.floor(wi/28);
					console.log('n28 is: '+n28);
					//n28 = 3;
                    var tempMain=v1;
                    var prevMain=v1;
                    var xMain = 20+100;
                    var yMain = 20;
					var lastArr=[];
					var tempLastMain;
					var initialMainV=mainV;
					//adjacent walls
					var screenFilter = 1;
					var venturiAssembly = 1;
					var byPassAssembly = 1;
					var pvcPipe1 = 0;
					var pvcPipe2=0;
					var pvcT=0;
					var pvcElbow=1; //used at the end
					var pvcReducer=0;
					var lateralPipe=0;
					var startConnector=0;
					var grommet=0;
					var inlineValve=0;
					var emitter=0;
					var flushValve=0;
					var airRelease=1;
					var pressureRelesase=1;
					var pvcControlValve=0;
					pvcElbow+=(walls-1);

                    width=Math.floor(wi*12/5.5);
                    xSub=20;
                    ySub=20;

					console.log("hei :"+height);

                    for(var i=0; i<hi; i++){
                        ySub+=30;
						kineticH= Math.pow(mainV,2)/(2*g);  //constant for elbow taken as 1
						yloss=yloss+kineticH-6*0.0254;  //6 inch pocket height (rho*g*h)
						tempPY=yloss*rho*g*0.000145;
								//console.log(i+':'+tempPY+','+mainV);
						mainV-=mainVloss;
                        tempSub = graph.insertVertex(parent, null, tempPY, xSub, ySub, 200, 20, 'fillColor=gray');
                        graph.insertEdge(parent, null, '', prevSub, tempSub);
                        prevEmit=tempSub;
                        xEmit=xSub+200;
                        yEmit=ySub;
                        for(var j=0; j<width; j++){
                            xEmit+=40;

                            tempEmit=graph.insertVertex(parent, null, '',xEmit, yEmit, 20, 20, 'fillColor=white');
                            graph.insertEdge(parent, null, '', prevEmit, tempEmit);
                            prevEmit=tempEmit;
                            //console.log("print j "+j);
                            if(j==width-1){
                                //console.log("asdf");
                                prevSub=prevEmit;
                                xSub=xEmit+40;
                            }
                        }
                        //ySub+=30;
                        //xSub+=1400;
						kineticH= Math.pow(mainV,2)/(2*g);
						yloss=yloss+kineticH;  //6 inch pocket height (rho*g*h)
						tempPY=yloss*rho*g*0.000145+pressureChange;		//pressure during the lateral travel is also added
								//console.log(i+':'+tempPY+','+mainV);
						//mainV-=mainVloss;
                        tempSub = graph.insertVertex(parent, null, tempPY, xSub, ySub, 200, 20, 'fillColor=gray');
                        graph.insertEdge(parent, null, '',prevSub, tempSub);
                        prevSub=tempSub;
                        ySub+=30;
						kineticH= Math.pow(mainV,2)/(2*g);
						yloss=yloss+kineticH-6*0.0254;  //6 inch pocket height (rho*g*h)
						tempPY=yloss*rho*g*0.000145;		//pressure during the lateral travel is also added
								//console.log(i+':'+tempPY+','+mainV);
						mainV-=mainVloss;
                        tempSub=graph.insertVertex(parent, null, tempPY, xSub, ySub, 200, 20, 'fillColor=gray');
                        graph.insertEdge(parent, null, '', prevSub, tempSub);
                        prevEmit=tempSub;
                        xEmit=xSub;
                        yEmit=ySub;
                        for(var j=0; j<width; j++){
                            xEmit-=40;
                            tempEmit=graph.insertVertex(parent, null, '', xEmit, yEmit, 20, 20, 'fillColor=white');
                            graph.insertEdge(parent, null, '', prevEmit, tempEmit);
                            prevEmit=tempEmit;
                            if(j==width-1){
                                prevSub=prevEmit;
                                xSub=xEmit-40-200;
                            }
                        }
						kineticH= Math.pow(mainV,2)/(2*g);
						yloss=yloss+kineticH;  //6 inch pocket height (rho*g*h)
						tempPY=yloss*rho*g*0.000145+pressureChange;		//pressure during the lateral travel is also added
								//console.log(i+':'+tempPY+','+mainV);
						//mainV-=mainVloss;
                        tempSub = graph.insertVertex(parent, null, tempPY, xSub, ySub, 200, 20, 'fillColor=gray');
                        graph.insertEdge(parent, null, '', prevSub, tempSub);
                        prevSub=tempSub;
                        //xSub=20;
                        //ySub-=30;
                        //xSub+=1400;

                    }
/*
                    for(var k=0; k<n28; k++){
						pvcPipe1+=28;
						pvcT+=2;
						pvcReducer+=2;
						flushValve+=2;
						pvcControlValve+=2;
                        tempMain = graph.insertVertex(parent, null, '', xMain, yMain, 20, 20, 'fillColor=blue');
                        xSub = xMain;
                        ySub = yMain + 30;
                        graph.insertEdge(parent, null, '',prevMain, tempMain);
                        prevSub = tempMain;
                        prevMain = tempMain;
                        xMain+=3000;
						kineticH=0;
						yloss=0;
						tempPY=0;
						mainV=initialMainV;
                        for(var i=0; i<height; i++){
							pvcPipe2+=0.5;
							lateralPipe+=28;
							startConnector+=1;
							grommet+=1;
							inlineValve+=1;
    			            kineticH= Math.pow(mainV,2)/(2*g);
    			            yloss=yloss+kineticH-6*0.0254;  //6 inch pocket (rho*g*h)
    			            tempPY=yloss*rho*g*0.000145;
    								//console.log(i+':'+tempPY+','+mainV);
    			            mainV-=mainVloss;
    						tempSub= graph.insertVertex(parent, null, tempPY, xSub, ySub,160,  20, 'fillColor=white')
    						xEmit= xSub+200;
    						yEmit= ySub;
    						graph.insertEdge(parent, null, '', prevSub, tempSub);
    						prevEmit= tempSub;
    						prevSub= tempSub;
    						ySub+= 54;
    						for(var j=0; j<56; j++){
								emitter+=1;
								if(j==55){
    								tempEmit= graph.insertVertex(parent, null, pressureChange, xEmit, yEmit, 200, 20, 'fillColor=white');
    								graph.insertEdge(parent, null, '', prevEmit, tempEmit);
									lastArr.push(tempEmit);
    							}
    							else {
    								tempEmit= graph.insertVertex(parent, null, '' + j, xEmit, yEmit, 20, 20, 'fillColor=lightblue');
    								graph.insertEdge(parent, null, '', prevEmit, tempEmit);
    							}
    							prevEmit= tempEmit;
    							xEmit+= 40;
    							//console.log(i+j);
    						}

    						//xSub+= 24;
    					}
						tempLastMain = graph.insertVertex(parent, null, '', xMain-200, yMain, 20, 20, 'fillColor=blue');
						xSub = xMain-300;
						ySub = yMain + 30;
						//xMain+=3000;
						kineticH=0;
						yloss=0;
						tempPY=0;
						mainV=initialMainV;
						graph.insertEdge(parent, null, '',prevMain, tempLastMain);
						for(var i=0;i<lastArr.length; i++){
							pvcPipe2+=0.5;
							startConnector+=1;
							grommet+=1;
							inlineValve+=1;
							kineticH= Math.pow(mainV,2)/(2*g);
    			            yloss=yloss+kineticH-6*0.0254;  //6 inch pocket (rho*g*h)
    			            tempPY=yloss*rho*g*0.000145;
    								//console.log(i+':'+tempPY+','+mainV);
    			            mainV-=mainVloss;
							tempSub= graph.insertVertex(parent, null, tempPY, xSub, ySub,160,  20, 'fillColor=white');
							graph.insertEdge(parent, null, '', tempSub, lastArr[i]);
							ySub+= 54;
							if(i==0){
								graph.insertEdge(parent, null, '', tempLastMain, tempSub);
							}
						}
						//graph.insertEdge(parent, null,'',tempLastMain,lastArr[0]);
						lastArr=[];

                    }

					width=(wi%28)*2;

					if(width>0){
						for(var k=0; k<1; k++){
							pvcPipe1+=(wi%28);
							pvcT+=2;
							pvcReducer+=2;
							flushValve+=2;
							pvcControlValve+=2;
	                        tempMain = graph.insertVertex(parent, null, '', xMain, yMain, 20, 20, 'fillColor=blue');
	                        xSub = xMain;
	                        ySub = yMain + 30;
	                        graph.insertEdge(parent, null, '',prevMain, tempMain);
	                        prevSub = tempMain;
	                        prevMain = tempMain;
	                        xMain+=3000;
							kineticH=0;
							yloss=0;
							tempPY=0;
							mainV=initialMainV;
	                        for(var i=0; i<height; i++){
								pvcPipe2+=0.5;
								lateralPipe+=(wi%28);
								startConnector+=1;
								grommet+=1;
								inlineValve+=1;
	    			            kineticH= Math.pow(mainV,2)/(2*g);
	    			            yloss=yloss+kineticH-6*0.0254;  //6 inch pocket (rho*g*h)
	    			            tempPY=yloss*rho*g*0.000145;
	    									//console.log(i+':'+tempPY+','+mainV);
	    			            mainV-=mainVloss;
	    						tempSub= graph.insertVertex(parent, null, tempPY, xSub, ySub,160,  20, 'fillColor=white')
	    						xEmit= xSub+200;
	    						yEmit= ySub;
	    						graph.insertEdge(parent, null, '', prevSub, tempSub);
	    						prevEmit= tempSub;
	    						prevSub= tempSub;
	    						ySub+= 54;
	    						for(var j=0; j<width; j++){
									emitter+=1;
	    							if(j==width-1){
	    								tempEmit= graph.insertVertex(parent, null, pressureChange, xEmit, yEmit, 200, 20, 'fillColor=white');
	    								graph.insertEdge(parent, null, '', prevEmit, tempEmit);
										lastArr.push(tempEmit);
	    							}
	    							else {
	    								tempEmit= graph.insertVertex(parent, null, '' + j, xEmit, yEmit, 20, 20, 'fillColor=lightblue');
	    								graph.insertEdge(parent, null, '', prevEmit, tempEmit);
	    							}
	    							prevEmit= tempEmit;
	    							xEmit+= 40;
	    							//console.log(i+j);
	    						}

	    						//xSub+= 24;
	    					}
							tempLastMain = graph.insertVertex(parent, null, '', xMain-200, yMain, 20, 20, 'fillColor=blue');
							xSub = xMain-300;
							ySub = yMain + 30;
							kineticH=0;
							yloss=0;
							tempPY=0;
							mainV=initialMainV;
							graph.insertEdge(parent, null, '',prevMain, tempLastMain);
							for(var i=0;i<lastArr.length; i++){
								pvcPipe2+=0.5;
								startConnector+=1;
								grommet+=1;
								inlineValve+=1;
								kineticH= Math.pow(mainV,2)/(2*g);
	    			            yloss=yloss+kineticH-6*0.0254;  //6 inch pocket (rho*g*h)
	    			            tempPY=yloss*rho*g*0.000145;
	    								//console.log(i+':'+tempPY+','+mainV);
	    			            mainV-=mainVloss;
								tempSub= graph.insertVertex(parent, null, tempPY, xSub, ySub,160,  20, 'fillColor=white');
								graph.insertEdge(parent, null, '', tempSub, lastArr[i]);
								ySub+= 54;
								if(i==0){
									graph.insertEdge(parent, null, '', tempLastMain, tempSub);
								}
							}
							//graph.insertEdge(parent, null,'',tempLastMain,lastArr[0]);
							lastArr=[];

	                    }
					}
					pvcPipe1*=walls;
					pvcPipe2*=walls;
					pvcT*=walls;
					pvcReducer*=walls;
					lateralPipe*=walls;
					startConnector*=walls;
					grommet*=walls;
					inlineValve*=walls;
					emitter*=walls;
					flushValve*=walls;
					pvcControlValve*=walls;
					console.log("screenFilter :"+screenFilter);
					console.log("venturiAssembly :"+venturiAssembly);
					console.log("byPassAssembly :"+byPassAssembly);
					console.log("pvcPipe1: "+pvcPipe1);
					console.log("pvcPipe2: "+pvcPipe2);
					console.log("pvcT: "+pvcT);
					console.log("pvcElbow :"+pvcElbow); //used at the end
					console.log("pvcReducer: "+pvcReducer);
					console.log("lateralPipe: "+lateralPipe);
					console.log("startConnector: "+startConnector);
					console.log("grommet: "+grommet);
					console.log("inlineValve: "+inlineValve);
					console.log("emitter: "+emitter);
					console.log("flushValve: "+flushValve);
					console.log("airRelease: "+airRelease);
					console.log("pressureRelesase: "+pressureRelesase);
					console.log("pvcControlValve: "+pvcControlValve);
                    */

          /*var xmlEncode = new mxCodec();
          var node = xmlEncode.encode(graph.getModel());
          mxUtils.popup(mxUtils.getPrettyXml(node), false);*/
				}
				finally
				{
					// Updates the display

					graph.getModel().endUpdate();
				}
			}
			/*
			var xmlDoc = mxUtils.createXmlDocument();
			var root = xmlDoc.createElement('output');
			xmlDoc.appendChild(root);

			var xmlCanvas = new mxXmlCanvas2D(root);
			var imgExport = new mxImageExport();
			imgExport.drawState(graph.getView().getState(graph.model.root), xmlCanvas);

			var bounds = graph.getGraphBounds();
			var w = Math.ceil(bounds.x + bounds.width);
			var h = Math.ceil(bounds.y + bounds.height);

			var xml = mxUtils.getXml(root);
			new mxXmlRequest('export', 'format=png&w=' + w +
		 	'&h=' + h + '&bg=#F9F7ED&xml=' + encodeURIComponent(xml))
		 	.simulate(document, '_blank');*/

		};


	</script>
</head>

<script>
	function second(container){
    //lateralD = mm, lateralL=feet, orificeQ=lph, mainL=feet, mainD=mm
		var lateralD=16, lateralL=20, orificeQ=4, mainL=10, mainD=16,walls=1;
		var wi = lateralL, hi = mainL;
		var g=10, rho=1000, C=150;
		//lateralL=28; //calclulating for 28*x ft^2

		var orificeN = Math.floor(lateralL*12/5.5);
		var lateralQ = orificeN*orificeQ/(60*60);
		console.log("orificeN :"+orificeN);
		console.log("orificeQ :"+orificeQ);
    	var lateralN = hi*2;

		mainL = mainL*0.0254*12;
		lateralQ = lateralQ/1000;
		lateralD=lateralD/1000; //cout << "lateralD :" << lateralD << endl;
		lateralL=lateralL*0.0254*12;
    	mainD = mainD/1000;
    	var lateralV = lateralQ*4/(3.14*lateralD*lateralD);
		var F1 = 0.63837*Math.pow(orificeN, -1.8916) + 0.35929;
		var hf = 10.77*lateralL*(Math.pow((lateralQ/C),1.852))*Math.pow(lateralD,-4.865);
		console.log("lateralQ :" +lateralQ);
    	var mainV = lateralQ*lateralN*4/(3.14*mainD*mainD);
		var mainQ = lateralQ*lateralN*1000*60;  // lpm
		console.log("mainQ (lpm):" + mainQ);

    	var smallD = lateralD-0.001;

		var squareS=0;
	  	for(var i=1; i<=orificeN; i++){
	    	squareS=squareS+Math.pow(i,1.852);
	  	}
	  	var F2=squareS/Math.pow(orificeN,2.852);
		//console.log("F2 :" + F2);

		var F3 = Math.pow((1.852+1),-1) + Math.pow(2*orificeN,-1) + Math.pow(1.852-1,0.5)/(6*Math.pow(orificeN,2));
		//console.log("F3 :" + F3);

		var temp1 = Math.max(F1, F2);
		temp1 = Math.max(temp1, F3);

    	var  k = 0.056*(Math.pow(lateralD/smallD,17.83)-1);
    	var hm =  k*(Math.pow(lateralV,2))/(2*g);

		var pressureChange = (hf+hm*orificeN)*g*rho*0.000145;
    	var kineticH = Math.pow(mainV,2)/(2*g);
		console.log("change in pressure caused in lateral (psi): "+ pressureChange);
		//console.log("kineticH :" + kineticH);
    	var mainVloss = lateralQ*4/(3.14*mainD*mainD);
		console.log("pressureChange :"+pressureChange);
		console.log("mainV :" + mainV);
		console.log("mainVloss :"+mainVloss);
		return main(container, pressureChange, wi, hi, mainV, mainVloss,walls);

	}
</script>


<body onload="second(document.getElementById('graphContainer'))">

	<div id="graphContainer"
		style="position:relative;overflow:hidden;width:50000px;height:50000px;background:url('editors/images/grid.gif');cursor:default;">
	</div>
</body>
</html>
